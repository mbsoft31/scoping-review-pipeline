{% extends "base.html" %}

{% block title %}Results - Systematic Review Pipeline{% endblock %}

{% block content %}
<div x-data="resultsApp()" x-init="init()">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Results Browser</h1>
        <p class="text-gray-600">View and manage your systematic review outputs.</p>
    </div>
    <!-- Tabs to switch between Phase 1 and Phase 2 directories -->
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="border-b border-gray-200">
            <nav class="flex -mb-px">
                <button @click="activeTab = 'phase1'" :class="activeTab === 'phase1' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="py-4 px-6 border-b-2 font-medium text-sm focus:outline-none">Phase 1</button>
                <button @click="activeTab = 'phase2'" :class="activeTab === 'phase2' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'" class="py-4 px-6 border-b-2 font-medium text-sm focus:outline-none">Phase 2</button>
            </nav>
        </div>
    </div>
    <!-- Phase 1 directory list -->
    <div x-show="activeTab === 'phase1'" class="space-y-4">
        {% for dir in phase1_dirs %}
        <div class="bg-white rounded-lg shadow hover:shadow-lg transition">
            <div class="p-6 flex items-start justify-between">
                <div class="flex-1">
                    <h3 class="text-lg font-semibold text-gray-800">{{ dir.name }}</h3>
                    <p class="text-sm text-gray-500 mt-1">Created: {{ dir.name.split('_')[-2] }} {{ dir.name.split('_')[-1] }}</p>
                </div>
                <div class="ml-4 flex flex-col space-y-2">
                    <button @click="viewPapers('{{ dir }}')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm font-medium">View Papers</button>
                    <button @click="exportBibtex('{{ dir }}')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm font-medium">Export BibTeX</button>
                </div>
            </div>
        </div>
        {% endfor %}
        {% if phase1_dirs|length == 0 %}
        <div class="bg-white rounded-lg shadow p-12 text-center">
            <div class="text-gray-400 text-6xl mb-4">ðŸ“­</div>
            <p class="text-gray-600">No Phase 1 results yet</p>
            <a href="/search" class="inline-block mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded font-medium">Start a Search</a>
        </div>
        {% endif %}
    </div>
    <!-- Phase 2 directory list -->
    <div x-show="activeTab === 'phase2'" class="space-y-4">
        {% for dir in phase2_dirs %}
        <div class="bg-white rounded-lg shadow hover:shadow-lg transition">
            <div class="p-6 flex items-start justify-between">
                <div class="flex-1">
                    <h3 class="text-lg font-semibold text-gray-800">{{ dir.name }}</h3>
                    <p class="text-sm text-gray-500 mt-1">Created: {{ dir.name.split('_')[-2] }} {{ dir.name.split('_')[-1] }}</p>
                </div>
                <div class="ml-4 flex flex-col space-y-2">
                    <button @click="viewPapers('{{ dir }}')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm font-medium">View Papers</button>
                    <button @click="exportBibtex('{{ dir }}', 100)" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm font-medium">Export Top 100</button>
                </div>
            </div>
        </div>
        {% endfor %}
        {% if phase2_dirs|length == 0 %}
        <div class="bg-white rounded-lg shadow p-12 text-center">
            <div class="text-gray-400 text-6xl mb-4">ðŸ“Š</div>
            <p class="text-gray-600">No Phase 2 results yet</p>
            <a href="/analyze" class="inline-block mt-4 bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded font-medium">Run Analysis</a>
        </div>
        {% endif %}
    </div>
    <!-- Modal for papers list -->
    <div x-show="showPapersModal" x-cloak @click.self="showPapersModal = false" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b border-gray-200 flex items-center justify-between">
                <h2 class="text-2xl font-bold text-gray-800">Papers</h2>
                <button @click="showPapersModal = false" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="overflow-y-auto" style="max-height: calc(90vh - 180px);">
                <div id="papers-container" hx-get="/api/results/:path/papers?page=1" hx-trigger="load" hx-swap="innerHTML">
                    <div class="p-8 text-center text-gray-500">Loading papers...</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}