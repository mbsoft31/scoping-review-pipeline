{% extends "base.html" %}

{% block title %}Search Papers - Systematic Review Pipeline{% endblock %}

{% block content %}
<div x-data="{form: {query: '', databases: ['openalex'], start_date: '', end_date: '', limit: 100}, loading: false, jobId: null}" class="max-w-3xl mx-auto">
    <div class="bg-white rounded-lg shadow p-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Search Academic Papers</h1>
        <p class="text-gray-600 mb-4">Configure your search across multiple academic databases.</p>
        <form @submit.prevent="async () => { loading = true; const payload = { query: form.query, databases: form.databases, start_date: form.start_date, end_date: form.end_date, limit: form.limit || null }; const res = await fetch('/api/search/start', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); const data = await res.json(); jobId = data.job_id; loading = false; if (window.htmx) { window.htmx.process(document.body); } }" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Search Query</label>
                <input x-model="form.query" type="text" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g. machine learning fairness">
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                    <input x-model="form.start_date" type="date" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                    <input x-model="form.end_date" type="date" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Databases</label>
                <select multiple x-model="form.databases" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="openalex" selected>OpenAlex</option>
                    <option value="semantic_scholar">Semantic Scholar</option>
                    <option value="crossref">Crossref</option>
                    <option value="arxiv">arXiv</option>
                </select>
                <p class="text-xs text-gray-500 mt-1">Hold Ctrl (Windows) or Cmd (Mac) to select multiple.</p>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Limit (per database)</label>
                <input x-model.number="form.limit" type="number" min="1" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g. 100">
                <p class="text-xs text-gray-500 mt-1">Leave blank to use default.</p>
            </div>
            <button type="submit" :disabled="loading" class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white py-3 rounded-lg font-semibold">
                <span x-show="!loading">üîé Start Search</span>
                <span x-show="loading">‚è≥ Starting...</span>
            </button>
        </form>
        <!-- Progress section -->
        <div x-show="jobId" class="mt-6 p-4 bg-blue-50 rounded" x-cloak>
            <h3 class="text-lg font-semibold text-gray-800 mb-2">Search Progress</h3>
            <div hx-get="/api/jobs/:jobId/progress" hx-trigger="every 2s" hx-swap="innerHTML" :hx-get="`/api/jobs/${jobId}/progress`">
                Loading progress...
            </div>
        </div>
    </div>
</div>
{% endblock %}