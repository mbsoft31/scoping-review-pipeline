{% extends "base.html" %}

{% block content %}
<div x-data="qualityApp()" class="max-w-6xl mx-auto">
    <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
        <h1 class="text-3xl font-bold text-gray-800 mb-4">Quality Assessment</h1>
        <p class="text-gray-600">
            Assess risk of bias and study quality using standard tools (RoBﾂ2, ROBINS窶選, Newcastle窶前ttawa).
        </p>
    </div>
    <!-- Input directory selection -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">沒 Select input directory</h3>
        <label class="block text-sm font-medium text-gray-700 mb-2">Phaseﾂ1.7 directory</label>
        <select x-model="phaseDir" class="w-full px-3 py-2 border rounded text-sm" required>
            <option value="">Select a directory...</option>
            {% for dir in phase_dirs %}
            <option value="{{ dir }}">{{ dir.name }}</option>
            {% endfor %}
        </select>
        <p class="text-xs text-gray-500 mt-1">Choose a directory containing extracted data (Phaseﾂ1.7).</p>
    </div>
    <!-- Tool selection -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Select Assessment Tool</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <label class="relative flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50" :class="config.tool === 'rob2' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'">
                <input type="radio" x-model="config.tool" value="rob2" class="sr-only">
                <div class="flex-1">
                    <div class="font-medium text-gray-900">RoBﾂ2</div>
                    <div class="text-xs text-gray-500">Cochrane tool for RCTs</div>
                </div>
            </label>
            <label class="relative flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50" :class="config.tool === 'robins_i' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'">
                <input type="radio" x-model="config.tool" value="robins_i" class="sr-only">
                <div class="flex-1">
                    <div class="font-medium text-gray-900">ROBINS窶選</div>
                    <div class="text-xs text-gray-500">Non窶喪andomized studies</div>
                </div>
            </label>
            <label class="relative flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50" :class="config.tool === 'newcastle_ottawa' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'">
                <input type="radio" x-model="config.tool" value="newcastle_ottawa" class="sr-only">
                <div class="flex-1">
                    <div class="font-medium text-gray-900">Newcastle窶前ttawa</div>
                    <div class="text-xs text-gray-500">Cohort & case窶祖ontrol</div>
                </div>
            </label>
        </div>
    </div>
    <!-- Start button -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <button @click="startAssessment()" :disabled="loading || !phaseDir" class="w-full bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 text-white font-bold py-3 rounded-lg">
            <span x-show="!loading">沁ｯ Start Quality Assessment</span>
            <span x-show="loading">竢ｳ Assessing...</span>
        </button>
    </div>
    <!-- Progress section -->
    <div x-show="jobId" class="mt-6 p-6 bg-indigo-50 rounded-lg" x-cloak>
        <h3 class="text-lg font-semibold text-gray-800 mb-3">Assessment Progress</h3>
        <div hx-get="/api/jobs/:jobId/progress" hx-trigger="every 2s" hx-swap="innerHTML" :hx-get="`/api/jobs/${jobId}/progress`">
            Loading progress...
        </div>
    </div>
</div>

{# Component logic moved to a TypeScript module loaded via Vite. #}
{% endblock %}